################################################################################
# Variables template used on this project, must be used in your .gitlab-ci.yml:
#
# variables:
#   extends: .default_variables
#
# Gitlab-CI variables documentation:
# https://docs.gitlab.com/ee/ci/variables
################################################################################

.default_variables:

  # Should be the same as 'include: ref:' from .gitlab-ci.yml.
  # Based on branch for this project.
  CI_REF: "4.x-dev"

  # Minor Drupal version to work with, limited to tags on
  # https://hub.docker.com/r/mogtofu33/drupal8ci/tags?name=3.x
  CI_DRUPAL_VERSION: "9.3"

  # Select what you are running CI on, options are:
  #   project
  #     A full Drupal project managed with composer.
  #   module
  #     A single Drupal module or theme.
  CI_TYPE: "project"
  # CI_TYPE: "module"

  # Relative path to the Drupal web root.
  # For a project based on Drupal this is 'web'. Can be 'docroot' or 'html' on
  # some distributions.
  CI_DRUPAL_WEB_ROOT: web

  # Path to the Drupal doc and web root.
  # Drupal official image create symlink /opt/drupal/web > /var/www/html
  # In case of a project we remove /opt/drupal and symlink CI_PROJECT_DIR to
  # /opt/drupal
  CI_DOC_ROOT: "/opt/drupal"
  CI_WEB_ROOT: "/opt/drupal/${CI_DRUPAL_WEB_ROOT}"

  # PHPunit tests to run, default provide only custom code or if this variable
  # is empty all tests (including Drupal core).
  # https://mog33.gitlab.io/gitlab-ci-drupal/advanced-usage/#phpunit-tests
  CI_PHPUNIT_TESTS: "custom"

  # Specify a group of tests to run rather than all tests in the suite.
  # PHPUNIT_GROUP: my_group_1,my_group_2

  # Nightwatch.js tests to run.
  # https://www.drupal.org/docs/8/testing/javascript-testing-using-nightwatch
  # Add --verbose for a full log from Nightwatch if it fail.
  # Default is to run everything except core. For a module / theme, add your tag.
  CI_NIGHTWATCH_TESTS: "--skiptags core"
  # CI_NIGHTWATCH_TESTS: "--tag custom"

  # If not using a db dump, select install profile for Behat tests.
  CI_BEHAT_INSTALL_PROFILE: "minimal"
  # If dump, select 'dump' profile and fill local or remote file.
  # CI_BEHAT_INSTALL_PROFILE: "dump"
  # Support local or remote file with extensions:
  #   .sql, .sql.gz, .pg_dump, .pg_dump.gz
  CI_BEHAT_INSTALL_DUMP: ""

  # See Phpqa available tools:
  # https://github.com/EdgedesignCZ/phpqa#available-tools
  CI_TOOLS_METRICS: "phpmetrics,phploc,pdepend"

  # Composer override to use github oauth token.
  # https://getcomposer.org/doc/06-config.md#github-oauth
  # CI_COMPOSER_GITHUB_OAUTH_TOKEN: ""

  # Composer override to use packagist mirror.
  # CI_COMPOSER_REPO_PACKAGIST_URL: "https://repo.packagist.org"

  # Yarn override to use registry mirror.
  # CI_YARN_REGISTRY: "https://registry.yarnpkg.com"

  ##############################################################################
  # List of CI_DIRS_* variables to define dirs to analyze for specific jobs.
  #
  # Code quality dirs, must include your PHP code to check.
  CI_DIRS_QA_PHPCS: "${CI_DRUPAL_WEB_ROOT}/**/custom"
  CI_DIRS_QA_PHPSTAN: "${CI_DIRS_QA_PHPCS}"
  CI_DIRS_QA_PHPCPD: "${CI_DIRS_QA_PHPCS}"
  CI_DIRS_QA_PARALINT: "${CI_DIRS_QA_PHPCS}"
  CI_DIRS_QA_PHPMD: "${CI_DRUPAL_WEB_ROOT}/modules/custom,${CI_DRUPAL_WEB_ROOT}/themes/custom"
  #
  CI_QA_PHPCS_STANDARD: "Drupal,DrupalPractice"
  CI_QA_IGNORE: "*/vendor/*,*/bootstrap/*,*/tests/*,*/.gitlab-ci/*,Readme.md,style.css,print.css,*Test.php,RoboFile.php"
  CI_QA_SUFFIX: "php,inc,module,install,test,profile,theme"
  CI_QA_PHPCPD_MIN_LINES: 5
  CI_QA_PHPCPD_MIN_TOKEN: 70
  #
  # Eslint / Stylelint files to test.
  #
  # Configuration files, default is Drupal used for core.
  CI_CONFIG_ESLINT: ${CI_DRUPAL_WEB_ROOT}/core/.eslintrc.passing.json
  CI_CONFIG_STYLELINT: ${CI_DRUPAL_WEB_ROOT}/core/.stylelintrc.json
  #
  # Space separated for multiple folders.
  # Default is to check files under all custom folders.
  CI_DIRS_JS: "${CI_DRUPAL_WEB_ROOT}/**/custom/**/*.js"
  CI_DIRS_YAML: "${CI_DRUPAL_WEB_ROOT}/**/custom/**/*.yml"
  CI_DIRS_CSS: "${CI_DRUPAL_WEB_ROOT}/**/custom/**/css/*.css"
  #
  # Twig templates files to test.
  CI_DIRS_TWIG: "${CI_DRUPAL_WEB_ROOT}/themes/custom"
  #
  # phpmetrics / phpstats dirs to include.
  #
  # Comma separated for multiple folders.
  # Default is to check all custom dirs.
  CI_DIRS_PHP: "${CI_DRUPAL_WEB_ROOT}/modules/custom,${CI_DRUPAL_WEB_ROOT}/themes/custom"

  ##############################################################################
  #
  # Skip Build, if not running any tests or deploy.
  CI_SKIP_BUILD: 0
  #
  ##############################################################################
  # Symfony security check on composer.lock
  CI_SKIP_SECURITY: 0
  # Skip all tests jobs.
  CI_SKIP_TESTS: 0
  #
  # OR skip single jobs in tests.
  # For tests information see
  # https://www.drupal.org/docs/8/testing/types-of-tests-in-drupal-8.
  #
  # PHPunit unit,kernel with code coverage and optional Codecove.io support
  CI_SKIP_TEST_UNITKERNEL: 0
  # PHPunit functional tests (browser tests)
  CI_SKIP_TEST_FUNCTIONAL: 0
  # PHPunit functional javascript tests (browser with javascript tests)
  CI_SKIP_TEST_FUNCTIONALJS: 0
  # Nightwatch tests (browser with javascript tests), since Drupal 8.6
  # Currently not fully ready for Drupal so skip by default.
  CI_SKIP_TEST_NIGHTWATCH: 0
  #
  # Third party tests.
  # Behat tests from behat_tests folder. Demo tests, skip by default.
  CI_SKIP_TEST_BEHAT: 0
  # Accessibility test, skip by default.
  CI_SKIP_TEST_PA11Y: 0
  #
  ##############################################################################
  # Skip all QA jobs.
  CI_SKIP_QA: 0
  #
  # OR skip single jobs in qa.
  #
  CI_SKIP_QA_PHPCS: 0
  CI_SKIP_QA_PHPMD: 0
  CI_SKIP_QA_PHPSTAN: 0
  CI_SKIP_QA_PARALINT: 0
  #
  ##############################################################################
  # Skip all lint jobs.
  CI_SKIP_LINT: 0
  #
  # OR skip single jobs in lint.
  #
  # CSS lint job with stylelint.
  CI_SKIP_LINT_CSS: 0
  # Javascript lint job with eslint.
  CI_SKIP_LINT_JS: 0
  # Yaml lint job with eslint.
  CI_SKIP_LINT_YAML: 0
  # Twig lint job using symfony console.
  CI_SKIP_LINT_TWIG: 0
  #
  ##############################################################################
  # Skip all metrics jobs (phpmetrics, phploc, pdepend)
  CI_SKIP_METRICS: 0
  #
  ##############################################################################

  ##############################################################################
  # Services used by some jobs (PHPunit, Behat, Nightwatch.js).
  #
  CI_DB_DRIVER: mysql
  # CI_DB_DRIVER: pgsql
  ## SQLite require specific SIMPLETEST_DB value, see below.
  # CI_DB_DRIVER: sqlite
  #
  # Database service as docker image and tag.
  CI_SERVICE_DATABASE: "mariadb:10"
  # CI_SERVICE_DATABASE: "mysql:8"
  CI_SERVICE_DATABASE_PORT: 3306
  # CI_SERVICE_DATABASE: "postgres:13-alpine"
  # CI_SERVICE_DATABASE_PORT: 5432
  #
  CI_SERVICE_CHROMEDRIVER: "drupalci/webdriver-chromedriver:production"
  CI_SERVICE_CHROMEDRIVER_PORT: 9515
  CI_SERVICE_CHROME: "mogtofu33/chrome-headless:${CI_REF}"
  CI_SERVICE_CHROME_PORT: 9222
  #
  ##############################################################################

  ##############################################################################
  # Other variables that do not need editing in normal usage.
  #
  # Required by service:mysql/mariadb.
  MYSQL_DATABASE: drupal
  MYSQL_USER: drupal
  MYSQL_PASSWORD: drupal
  MYSQL_ALLOW_EMPTY_PASSWORD: 1
  # Required by service:pgsql.
  POSTGRES_PASSWORD: drupal
  POSTGRES_DB: drupal
  POSTGRES_USER: drupal
  #
  # Required by Drupal tests with PHPunit.
  # Build is the Gitlab-ci name of the running container with the /builds code.
  # This is provided by FF_NETWORK_PER_BUILD.
  # https://git.drupalcode.org/project/drupal/-/blob/HEAD/core/phpunit.xml.dist
  SIMPLETEST_BASE_URL: "http://build"
  SIMPLETEST_DB: "${CI_DB_DRIVER}://drupal:drupal@db/drupal"
  # SIMPLETEST_DB: "sqlite://localhost/:memory:"
  #
  BROWSERTEST_OUTPUT_DIRECTORY: "${CI_WEB_ROOT}/sites/simpletest"
  SYMFONY_DEPRECATIONS_HELPER: "disabled"
  #
  # Functional Javascript tests.
  MINK_DRIVER_ARGS_WEBDRIVER: >
    [
      "chrome",
      {
        "browserName":"chrome",
        "chromeOptions":{
          "w3c":false,
          "args":[
            "--headless",
            "--no-sandbox",
            "--disable-gpu",
            "--window-size=1920,1080"
          ]
        }
      },
      "http://chrome:${CI_SERVICE_CHROMEDRIVER_PORT}"
    ]
  #
  # Behat tests.
  #
  # Settings for Behat with DrupalExtension, match the tests on behat_tests
  # included in this project.
  # https://www.drupal.org/project/drupalextension
  BEHAT_PARAMS: >
    {
      "extensions" : {
        "Drupal\\DrupalExtension" : {
          "drupal" : {
            "drupal_root" : "${CI_WEB_ROOT}"
          }
        }
      }
    }
  # Chrome options, used by mogtofu33/chrome-headless startup.
  # https://peter.sh/experiments/chromium-command-line-switches/
  CHROME_OPTS: "--headless --no-sandbox --disable-gpu --window-size=1920,1080 --remote-debugging-address=0.0.0.0 --remote-debugging-port=${CI_SERVICE_CHROME_PORT}"
  #
  # Nightwatch settings.
  #
  # https://git.drupalcode.org/project/drupal/blob/HEAD/core/tests/README.md#running-nightwatch-tests
  # https://git.drupalcode.org/project/drupal/-/blob/HEAD/core/.env.example
  DRUPAL_TEST_WEBDRIVER_CHROME_ARGS: "--headless --no-sandbox --disable-gpu --window-size=1920,1080"
  DRUPAL_NIGHTWATCH_SEARCH_DIRECTORY: "../"
  DRUPAL_NIGHTWATCH_IGNORE_DIRECTORIES: "node_modules,vendor,.*,sites/*/files,sites/*/private,sites/default/files/simpletest"
  DRUPAL_NIGHTWATCH_OUTPUT: ${CI_PROJECT_DIR}/report-nightwatchjs
  #
  # General settings.
  #
  # Enable Docker network bridge to access services.
  # https://docs.gitlab.com/runner/configuration/feature-flags.html#available-feature-flags
  FF_NETWORK_PER_BUILD: 1
  #
  # Config files location for inclusion if not present locally (from ./.gitlab-ci/).
  CI_REMOTE_FILES: "https://gitlab.com/mog33/gitlab-ci-drupal/-/raw/${CI_REF}/.gitlab-ci"
  #
  # Docker image version used for CI.
  # Should be the same as CI_REF, but can be overridden for some use cases.
  CI_IMAGE_REF: ${CI_REF}
  #
  # Internal verbosity for RoboFile.php scripts.
  CI_VERBOSE: 0
  #
  # Make CI very (very!) verbose in case of problem.
  # https://docs.gitlab.com/ee/ci/variables/#debug-logging
  # CI_DEBUG_TRACE: 1